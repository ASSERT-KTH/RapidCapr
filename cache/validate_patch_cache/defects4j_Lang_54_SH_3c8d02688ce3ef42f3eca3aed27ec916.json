{
    "patch": "        if (len >= 2) {\n            char ch0 = str.charAt(0);\n            char ch1 = str.charAt(1);\n            if (!isAlpha(ch0) || !isAlpha(ch1)) {\n                throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n            }\n        }\n        if (len >= 3) {\n            char ch2 = str.charAt(2);\n            if (ch2 != '_' && ch2 != '-') {\n                throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n            }\n        }\n        if (len >= 4) {\n            char ch3 = str.charAt(3);\n            if (ch3 == '_' || ch3 == '-') {\n                throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n            }\n            if (!isAlphaNumeric(ch3)) {\n                throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n            }\n            if (len == 4) {\n                return new Locale(str.substring(0, 2), str.substring(3));\n            } else {\n                char ch4 = str.charAt(4);\n                if (ch4 == '_' || ch4 == '-') {\n                    throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n                }\n                if (!isAlphaNumeric(ch4) && (ch4 != '.' || len < 7 || !str.substring(5, 7).matches(\"\\\\d{2}\"))) {\n                    throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n                }\n                if (len == 5) {\n                    return new Locale(str.substring(0, 2), str.substring(3, 5), str.substring(4));\n                } else {\n                    if (str.charAt(5) != '_' && str.charAt(5) != '-') {\n                        throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n                    }\n                    int index = str.indexOf('_', 6);\n                    if (index == -1) {\n                        index = str.indexOf('-', 6);\n                    }\n                    if (index == -1) {\n                        return new Locale(str.substring(0, 2), str.substring(3, 5), str.substring(6));\n                    } else {\n                        if (index == len - 1) {\n                            throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n                        } else {\n                            char ch5 = str.charAt(5);\n                            if (ch5 == '-') {\n                                return new Locale.Builder().setLanguageTag(str).build();\n                            } else {\n                                String variant;\n                                if (index + 1 == len - 2 && str.charAt(len - 1) == 'V' &&\n                                        str.charAt(len - 2) == '9') {\n                                    variant = \"1999\";\n                                } else {\n                                    variant = str.substring(6, index);\n                                }\n                                return new Locale(str.substring(0, 2), str.substring(3, 5), variant, str.substring(index + 1));\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n    }\n\n    private static boolean isAlpha(char c) {\n        return (c >= 'a' && c <= 'z') || (c >= 'A' && c <= 'Z');\n    }\n\n    private static boolean isNumeric(char c) {\n        return (c >= '0' && c <= '9');\n    }\n\n    private static boolean isAlphaNumeric(char c) {\n        return isAlpha(c) || isNumeric(c);\n    }",
    "patch_diff": "diff --git a/src/java/org/apache/commons/lang/LocaleUtils.java b/src/java/org/apache/commons/lang/LocaleUtils.java\nindex 139d9a7f..4d1aba3e 100644\n--- a/src/java/org/apache/commons/lang/LocaleUtils.java\n+++ b/src/java/org/apache/commons/lang/LocaleUtils.java\n@@ -111,6 +111,85 @@ public class LocaleUtils {\n                 throw new IllegalArgumentException(\"Invalid locale format: \" + str);\n             }\n             char ch3 = str.charAt(3);\n+        if (len >= 2) {\n+            char ch0 = str.charAt(0);\n+            char ch1 = str.charAt(1);\n+            if (!isAlpha(ch0) || !isAlpha(ch1)) {\n+                throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n+            }\n+        }\n+        if (len >= 3) {\n+            char ch2 = str.charAt(2);\n+            if (ch2 != '_' && ch2 != '-') {\n+                throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n+            }\n+        }\n+        if (len >= 4) {\n+            char ch3 = str.charAt(3);\n+            if (ch3 == '_' || ch3 == '-') {\n+                throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n+            }\n+            if (!isAlphaNumeric(ch3)) {\n+                throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n+            }\n+            if (len == 4) {\n+                return new Locale(str.substring(0, 2), str.substring(3));\n+            } else {\n+                char ch4 = str.charAt(4);\n+                if (ch4 == '_' || ch4 == '-') {\n+                    throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n+                }\n+                if (!isAlphaNumeric(ch4) && (ch4 != '.' || len < 7 || !str.substring(5, 7).matches(\"\\\\d{2}\"))) {\n+                    throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n+                }\n+                if (len == 5) {\n+                    return new Locale(str.substring(0, 2), str.substring(3, 5), str.substring(4));\n+                } else {\n+                    if (str.charAt(5) != '_' && str.charAt(5) != '-') {\n+                        throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n+                    }\n+                    int index = str.indexOf('_', 6);\n+                    if (index == -1) {\n+                        index = str.indexOf('-', 6);\n+                    }\n+                    if (index == -1) {\n+                        return new Locale(str.substring(0, 2), str.substring(3, 5), str.substring(6));\n+                    } else {\n+                        if (index == len - 1) {\n+                            throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n+                        } else {\n+                            char ch5 = str.charAt(5);\n+                            if (ch5 == '-') {\n+                                return new Locale.Builder().setLanguageTag(str).build();\n+                            } else {\n+                                String variant;\n+                                if (index + 1 == len - 2 && str.charAt(len - 1) == 'V' &&\n+                                        str.charAt(len - 2) == '9') {\n+                                    variant = \"1999\";\n+                                } else {\n+                                    variant = str.substring(6, index);\n+                                }\n+                                return new Locale(str.substring(0, 2), str.substring(3, 5), variant, str.substring(index + 1));\n+                            }\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+        throw new IllformedLocaleException(\"Invalid locale format: \" + str);\n+    }\n+\n+    private static boolean isAlpha(char c) {\n+        return (c >= 'a' && c <= 'z') || (c >= 'A' && c <= 'Z');\n+    }\n+\n+    private static boolean isNumeric(char c) {\n+        return (c >= '0' && c <= '9');\n+    }\n+\n+    private static boolean isAlphaNumeric(char c) {\n+        return isAlpha(c) || isNumeric(c);\n+    }\n             char ch4 = str.charAt(4);\n             if (ch3 < 'A' || ch3 > 'Z' || ch4 < 'A' || ch4 > 'Z') {\n                 throw new IllegalArgumentException(\"Invalid locale format: \" + str);",
    "result_reason": "error: illegal start of expression",
    "test_result": "ERROR"
}